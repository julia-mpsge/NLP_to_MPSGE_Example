var documenterSearchIndex = {"docs":
[{"location":"#Comparing-Models","page":"Comparing Models","title":"Comparing Models","text":"","category":"section"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"This document will compare the solutions from NLP_model and MPSGE_model. They both describe the same economic model, but one is implemented in the traditional NLP framework and the other in MPSGE.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"using NLP_to_MPSGE_Example\nusing JuMP, MPSGE, DataFrames","category":"page"},{"location":"#Initialization","page":"Comparing Models","title":"Initialization","text":"","category":"section"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Initialize the data","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"data = ModelData()","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Initialize the models","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"nlp = NLP_model(data)\nmpsge = MPSGE_model(data)","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Verify the model by solving the baseline scenario","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"optimize!(nlp)\nsolve!(mpsge; cumulative_iteration_limit=0)","category":"page"},{"location":"#Comparing-Solutions","page":"Comparing Models","title":"Comparing Solutions","text":"","category":"section"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"The NLP version of the model has more variables the MPSGE version, however, the solutions to both are the same.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Set parameter values for a counterfactual","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"params = ModelParameters(\n    balance_of_payments = 10.0,\n    elas_substitution = 0.5,\n    elas_transformation = 0.5,\n    tax_domestic = .1,\n    tax_import = .2,\n    price_world_export = 1.1,\n    price_world_import = 1.2,\n    subsidy_export = 0.05,\n    )\n\nset_parameter_values(nlp, params)\nset_parameter_values(mpsge, params)\n\noptimize!(nlp)\nsolve!(mpsge)","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"This is a method to view all the variable values in a DataFrame. Let's use this to compare the two models. Note that I've used some fancy operations, I've tried to space things out for clarity, you can extract each piece and run it separately to understand what is happening.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"outerjoin(\n\n    zip(JuMP.name.(all_variables(nlp)), value.(all_variables(nlp))) |>\n        x -> DataFrame(var = first.(x), nlp = last.(x)),\n\n    generate_report(mpsge) |>\n        x -> transform(x, :var => ByRow(y -> JuMP.name(y)) => :var) |>\n        x -> select(x, :var, :value => :mpsge),\n\n    on = :var,\n)","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"The variables present in the MPSGE model can be directly compared to the NLP model. However, neither X nor Q match. This is because in MPSGE, these are activity levels that produce quantities of goods, whereas in the NLP model, these are quantities of goods themselves. Let's focus on X as Q is similar.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Look at the MPSGE model and search for any productions that use X0. That would be the X block","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"production(mpsge[:X])","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Or, in the code:","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"@production(MP, X, [t=omega,s=0], begin        @output(PFX, E0*PWE, t, reference_price = 1/PWE, taxes = [Tax(Y, -TE)]) # Negative tax for export subsidy        @output(PDD, DS0, t)        @input(PX, X0, s)    end)","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"PX is the commodity associated with X0, so to get X we compute the compensated demand for X with respect to PX, and scale it by the activity level of X:","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"X = value(compensated_demand(mpsge[:X], mpsge[:PX])*mpsge[:X])\nQ = value(compensated_demand(mpsge[:Q], mpsge[:PQ])*mpsge[:Q])","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"The - on Q is signifying that the value comes from an output.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Next up, parameters. MPSGE does not report the parameter values. We can display these using:","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"parameters(mpsge)\nvalue.(parameters(mpsge))","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"The above displays two vectors. It would be a good exercise to put these in a DataFrame, and vcat it to the previous mpsge dataframe.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Next, the four quantities, DD, DS, E, and M. The idea is identical to X and Q. The exception is for E and M, which require scaling by the world prices.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"DD = value(compensated_demand(mpsge[:Q], mpsge[:PDD])*mpsge[:Q])\nDS = value(compensated_demand(mpsge[:X], mpsge[:PDD])*mpsge[:X])\nE = value(compensated_demand(mpsge[:X], mpsge[:PFX])*mpsge[:X]/mpsge[:PWE])\nM = value(compensated_demand(mpsge[:Q], mpsge[:PFX])*mpsge[:Q]/mpsge[:PWM])","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"The GR variable in the NLP model corresponds to the tax revenues in MPSGE. There should be a better function for this, but for now we can compute it as:","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"value(MPSGE.tax_revenue(mpsge[:X], mpsge[:Y]; virtual = true)) +\nvalue(MPSGE.tax_revenue(mpsge[:Q], mpsge[:Y]; virtual = true))","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Finally, the three prices. I am first going to demonstrate a method to extract the price directly from the MPSGE model, then show how to compute them manually. This should be a function in MPSGE, I will work on it for a future release.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"P = production(mpsge[:Q])\nO = input(P)\nN = O.children[2]\nCF = cost_function(N)\nPDT = value(CF)","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Manually:","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"PDT = value(mpsge[:PDD]*(1 + mpsge[:TD]))\nPMD = value(mpsge[:PFX]*(1 + mpsge[:TM])*mpsge[:PWM])\nPED = value(mpsge[:PFX]*(1 + mpsge[:TE])*mpsge[:PWE])","category":"page"},{"location":"#Recreating-Results","page":"Comparing Models","title":"Recreating Results","text":"","category":"section"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"In this part we will recreate tables 5.4 and 5.5 from the reference paper. These tables are on pages 42 (45 of document) and 45 (48 of document). These tables show the effects of changing the elasticity parameters and balance of payments on key variables in the model.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"shocks = [\n    ModelParameters(balance_of_payments = 0,    elas_substitution = 0.2, elas_transformation = 0.2,),\n    ModelParameters(balance_of_payments = 10.0, elas_substitution = 0.2, elas_transformation = 0.2,),\n    ModelParameters(balance_of_payments = 10.0, elas_substitution = 0.5, elas_transformation = 0.5,),\n    ModelParameters(balance_of_payments = 10.0, elas_substitution = 2,   elas_transformation = 2,  ),\n    ModelParameters(balance_of_payments = 10.0, elas_substitution = 5,   elas_transformation = 5,  ),\n    ModelParameters(balance_of_payments = 10.0, elas_substitution = 15,  elas_transformation = .2, ),\n    ModelParameters(balance_of_payments = 10.0, elas_substitution = .2,  elas_transformation = 15, ),\n\n    ModelParameters(price_world_import = 1.1, elas_substitution = 0.2, elas_transformation = 0.2,),\n    ModelParameters(price_world_import = 1.1, elas_substitution = 0.5, elas_transformation = 0.5,),\n    ModelParameters(price_world_import = 1.1, elas_substitution = 2,   elas_transformation = 2,  ),\n    ModelParameters(price_world_import = 1.1, elas_substitution = 5,   elas_transformation = 5,  ),\n    ModelParameters(price_world_import = 1.1, elas_substitution = 15,  elas_transformation = .2, ),\n    ModelParameters(price_world_import = 1.1, elas_substitution = .2,  elas_transformation = 15, ),\n];\nnothing #hide","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"We will also set the models to silent mode to avoid cluttering the output","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"set_silent(nlp)\nset_silent(mpsge)","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"To run the shocks and collect the results, we do two steps:","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Create empty DataFrames to hold the results\nLoop through each shock, set the parameters, solve the models, generate the reports, and append them to the results DataFrames.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"However, this requires the DataFrame be empty at the start of each loop. To ensure this, we can use a begin...end block to create a code block.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"begin\n    nlp_results = DataFrame();\n    mpsge_results = DataFrame();\n    for shock in shocks\n        set_parameter_values(nlp, shock)\n        set_parameter_values(mpsge, shock)\n\n        optimize!(nlp)\n        solve!(mpsge)\n\n        nlp_report = report(nlp)\n        mpsge_report = report(mpsge)\n\n        push!(nlp_results, nlp_report[1, :])\n        push!(mpsge_results, mpsge_report[1, :])\n    end\nend","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"The table results can be viewed by simply typing the DataFrame name.","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"nlp_results","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"MPSGE results","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"mpsge_results","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"Are these the same? Substract and round:","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"round.(nlp_results .- mpsge_results, digits=6)","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"What do the columns in the report mean? Check the doc string for report. You can do this either by entering the help mode in the REPL, just type ? in the REPL to switch to help mode and type report, or by using the @doc macro:","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"@doc report","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"","category":"page"},{"location":"","page":"Comparing Models","title":"Comparing Models","text":"This page was generated using Literate.jl.","category":"page"},{"location":"docs/#API-Reference","page":"API Reference","title":"API Reference","text":"","category":"section"},{"location":"docs/","page":"API Reference","title":"API Reference","text":"","category":"page"},{"location":"docs/#NLP_to_MPSGE_Example.ModelData","page":"API Reference","title":"NLP_to_MPSGE_Example.ModelData","text":"ModelData\n\nHolds the initial data for the economic model.\n\nFields\n\ninitial_exports::Float64: Initial exports value.\ninitial_imports::Float64: Initial imports value.\ninitial_production::Float64: Initial production value.\ninitial_consumption::Float64: Initial consumption value.\ndomestic_demand::Float64: Domestic demand value.\ndomestic_supply::Float64: Domestic supply value.\ninitial_consumer_price_index::Float64: Initial consumer price index.\ninitial_world_import_price::Float64: Initial world import price.\ninitial_world_export_price::Float64: Initial world export price.\ninitial_domestic_price::Float64: Initial domestic price.\n\nDefault Values\n\ninitial_exports = 25.0\ninitial_imports = 25.0\ninitial_production = 100.0\ninitial_consumption = 100.0\ndomestic_demand = 75.0\ndomestic_supply = 75.0\ninitial_consumer_price_index = 1.0\ninitial_world_import_price = 1.0\ninitial_world_export_price = 1.0\ninitial_domestic_price = 1.0\n\n\n\n\n\n","category":"type"},{"location":"docs/#NLP_to_MPSGE_Example.ModelParameters","page":"API Reference","title":"NLP_to_MPSGE_Example.ModelParameters","text":"ModelParameters\n\nHolds the parameters for the models.\n\nFields\n\nelas_substitution::Float64: Elasticity of substitution.\nelas_transformation::Float64: Elasticity of transformation.\nbalance_of_payments::Float64: Balance of payments.\nprice_world_export::Float64: World export price.\nprice_world_import::Float64: World import price.\ntax_import::Float64: Import tax.\nsubsidy_export::Float64: Export subsidy.\ntax_domestic::Float64: Domestic tax.\n\nDefault Values\n\nelas_substitution = 0.2\nelas_transformation = 0.2\nbalance_of_payments = 0.0\nprice_world_export = 1.0\nprice_world_import = 1.0\ntax_import = 0.0\nsubsidy_export = 0.0\ntax_domestic = 0.0\n\n\n\n\n\n","category":"type"},{"location":"docs/#NLP_to_MPSGE_Example.MCP_model-Tuple{ModelData}","page":"API Reference","title":"NLP_to_MPSGE_Example.MCP_model","text":"MCP_model(data::ModelData; subterms = false)\n\nCreates a Mixed Complementarity Problem (MCP) model based on the provided ModelData. If subterms is set to true, intermediate variables for revenues and costs are created for better clarity in the model formulation.\n\nThis model is included as an example of the explict MCP equation generated by MPSGE.  It was initially created to test a bug. This model will solve for most parameter values if subterms=false, but may fail to solve for some parameter values if subterms=true.\n\nThe report will not work with this model. \n\n\n\n\n\n","category":"method"},{"location":"docs/#NLP_to_MPSGE_Example.MPSGE_model-Tuple{ModelData}","page":"API Reference","title":"NLP_to_MPSGE_Example.MPSGE_model","text":"MPSGE_model(data::ModelData)\n\nCreates an MPSGEModel based on the provided ModelData. The numeraire is PQ,  the consumer price index, which is fixed to 1.\n\nParameters\n\nsigma: Elasticity of substitution\nomega: Elasticity of transformation\nBBAR: Balance of payments\nPWE: World export price\nPWM: World import price\nTM: Import tax rate\nTE: Export subsidy rate\nTD: Domestic tax rate\n\nSectors\n\nX: Production sector\nQ: Consumption sector\n\nCommodities\n\nPFX: Nominal exchange rate\nPX: Producer price index\nPQ: Consumer price index\nPDD: Domestic price excluding taxes\n\nConsumers\n\nY: Representative Agent\n\n\n\n\n\n","category":"method"},{"location":"docs/#NLP_to_MPSGE_Example.NLP_model-Tuple{ModelData}","page":"API Reference","title":"NLP_to_MPSGE_Example.NLP_model","text":"NLP_model(data::ModelData)\n\nCreates a JuMP model representing the NLP economic model based on the provided ModelData.\n\nThe numeraire is PQ, the consumer price index, which is fixed to 1.\n\nParameters\n\nsigma: Elasticity of substitution\nomega: Elasticity of transformation\nBBAR: Balance of payments\nPWE: World export price\nPWM: World import price\nTM: Import tax rate\nTE: Export subsidy rate\nTD: Domestic tax rate\n\nVariables\n\nDD: Domestic Demand\nDS: Domestic Supply\nM: Imports\nE: Exports\nX: Compound good (production)\nY: PNB\nPX: Producer price index\nPQ: Consumer price index\nPED: Export price including subsidy\nPMD: Import price including duties\nPDT: Domestic Price including taxes\nPDD: Domestic Price excluding taxes\nPFX: Nominal exchange rate\nQ: Consumption of the compound good\nGR: Government Revenue\n\n\n\n\n\n","category":"method"},{"location":"docs/#NLP_to_MPSGE_Example.report-Tuple{JuMP.Model}","page":"API Reference","title":"NLP_to_MPSGE_Example.report","text":"report(M::JuMP.Model)\nreport(M::MPSGEModel)\n\nGenerates a report DataFrame summarizing key variables from the provided model M.\n\nColumns\n\nsigma: Elasticity of substitution\nomega: Elasticity of transformation\nBBAR: Balance of payments\nPWM: World import price\nPWE: World export price\nTX: Export subsidy\nTM: Import tax\nTD: Domestic tax\nPED: Export price including subsidy\nPMD: Import price including duties\nQ: Consumption of the compound good\nPD: Domestic price excluding taxes\nTCR: Real exchange rate\nTCRE: Real exchange rate for exports\nTCRM: Real exchange rate for imports\nTCERQ: Real effective echange rate for consumption\nTCERX: Real effective exchange rate for production\nTCN: Nominal exchange rate\nE: Exports\nDD: Domestic demand\nM: Imports\n\n\n\n\n\n","category":"method"}]
}
